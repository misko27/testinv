<div class="portfolio-container">
  <div class="portfolio-header">
    <h2>My Portfolio</h2>
    <button
      class="refresh-btn"
      (click)="refreshPrices()"
      [disabled]="loading()"
    >
      {{ loading() ? 'Updating...' : 'üîÑ Refresh Prices' }}
    </button>
  </div>

  <!-- Portfolio Summary -->
  <div class="portfolio-summary">
    <div class="summary-card">
      <span class="label">Total Value</span>
      <span class="value">{{ formatCurrency(summary().totalValue) }}</span>
    </div>
    <div class="summary-card">
      <span class="label">Total Cost</span>
      <span class="value">{{ formatCurrency(summary().totalCost) }}</span>
    </div>
    <div class="summary-card" [class.positive]="isPositive(summary().totalGainLoss)" [class.negative]="!isPositive(summary().totalGainLoss)">
      <span class="label">Total Gain/Loss</span>
      <span class="value">{{ formatCurrency(summary().totalGainLoss) }}</span>
      <span class="percent">{{ formatPercent(summary().totalGainLossPercent) }}</span>
    </div>
  </div>

  <!-- Holdings Table -->
  <div class="table-container">
    <table class="holdings-table">
      <thead>
        <tr>
          <th>Symbol</th>
          <th>Name</th>
          <th>Quantity</th>
          <th>Last Price</th>
          <th>Market Value</th>
          <th>Average Cost</th>
          <th>Total Cost</th>
          <th>Gain/Loss</th>
          <th>Gain/Loss %</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (holding of holdings(); track holding.id) {
          <tr>
            <td class="symbol-cell">{{ holding.symbol }}</td>
            <td class="name-cell">{{ holding.name }}</td>
            <td class="quantity-cell">{{ holding.quantity }}</td>
            <td class="price-cell">{{ formatCurrency(holding.currentPrice) }}</td>
            <td class="value-cell">{{ formatCurrency(holding.marketValue) }}</td>
            <td class="cost-cell">{{ formatCurrency(holding.averageCost) }}</td>
            <td class="cost-cell">{{ formatCurrency(holding.totalCost) }}</td>
            <td
              class="gain-loss-cell"
              [class.positive]="isPositive(holding.gainLoss)"
              [class.negative]="!isPositive(holding.gainLoss)"
            >
              {{ formatCurrency(holding.gainLoss) }}
            </td>
            <td
              class="percent-cell"
              [class.positive]="isPositive(holding.gainLossPercent)"
              [class.negative]="!isPositive(holding.gainLossPercent)"
            >
              {{ formatPercent(holding.gainLossPercent) }}
            </td>
            <td class="actions-cell">
              <button
                class="remove-btn"
                (click)="removeHolding(holding.id)"
                title="Remove holding"
              >
                üóëÔ∏è
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  @if (holdings().length === 0) {
    <div class="empty-state">
      <p>No holdings in your portfolio yet.</p>
      <p>Add some stocks to get started!</p>
    </div>
  }

  <!-- Footer Note -->
  <div class="footer-note">
    <p>
      üíº Portfolio data is stored locally in your browser.
      Prices are updated from Alpha Vantage API.
    </p>
  </div>
</div>