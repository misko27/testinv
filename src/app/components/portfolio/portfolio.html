<div class="portfolio-container">
  <div class="portfolio-header">
    <h2>My Portfolio</h2>
  </div>

  <!-- Portfolio Summary -->
  <div class="portfolio-summary">
    <div class="summary-card">
      <span class="label">Total Value</span>
      <span class="value">{{ formatCurrency(summary().totalValue) }}</span>
    </div>
    <div class="summary-card">
      <span class="label">Total Cost</span>
      <span class="value">{{ formatCurrency(summary().totalCost) }}</span>
    </div>
    <div
      class="summary-card"
      [class.positive]="isPositive(summary().totalGainLoss)"
      [class.negative]="!isPositive(summary().totalGainLoss)"
    >
      <span class="label">Total Gain/Loss</span>
      <span class="value">{{ formatCurrency(summary().totalGainLoss) }}</span>
      <span class="percent">{{ formatPercent(summary().totalGainLossPercent) }}</span>
    </div>
  </div>

  <!-- Portfolio Allocation Chart -->
  <div class="allocation-section">
    <h3>Portfolio Allocation</h3>
    <div class="allocation-content">
      <div class="donut-chart" [style.background]="chartGradient()">
        <div class="donut-hole">
          <span class="donut-total">{{ allocation().length }}</span>
          <span class="donut-label">Holdings</span>
        </div>
      </div>
      <div class="allocation-legend">
        @for (item of allocation(); track item.symbol) {
          <div class="legend-item">
            <span class="legend-color" [style.background]="item.color"></span>
            <span class="legend-symbol">{{ item.symbol }}</span>
            <span class="legend-percent">{{ item.percent | number: '1.1-1' }}%</span>
            <span class="legend-value">{{ formatCurrency(item.value) }}</span>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Holdings Table -->
  <div class="table-container">
    <table class="holdings-table">
      <thead>
        <tr>
          <th class="sortable" (click)="toggleSort('symbol')">
            Symbol <span class="sort-icon">{{ getSortIcon('symbol') }}</span>
          </th>
          <th class="sortable" (click)="toggleSort('name')">
            Name <span class="sort-icon">{{ getSortIcon('name') }}</span>
          </th>
          <th class="sortable" (click)="toggleSort('quantity')">
            Quantity <span class="sort-icon">{{ getSortIcon('quantity') }}</span>
          </th>
          <th class="sortable" (click)="toggleSort('currentPrice')">
            Last Price <span class="sort-icon">{{ getSortIcon('currentPrice') }}</span>
          </th>
          <th class="sortable" (click)="toggleSort('marketValue')">
            Market Value <span class="sort-icon">{{ getSortIcon('marketValue') }}</span>
          </th>
          <th class="sortable" (click)="toggleSort('averageCost')">
            Average Cost <span class="sort-icon">{{ getSortIcon('averageCost') }}</span>
          </th>
          <th class="sortable" (click)="toggleSort('totalCost')">
            Total Cost <span class="sort-icon">{{ getSortIcon('totalCost') }}</span>
          </th>
          <th class="sortable" (click)="toggleSort('gainLoss')">
            Gain/Loss <span class="sort-icon">{{ getSortIcon('gainLoss') }}</span>
          </th>
          <th class="sortable" (click)="toggleSort('gainLossPercent')">
            Gain/Loss % <span class="sort-icon">{{ getSortIcon('gainLossPercent') }}</span>
          </th>
        </tr>
      </thead>
      <tbody>
        @for (holding of sortedHoldings(); track holding.id) {
          <tr>
            <td class="symbol-cell">{{ holding.symbol }}</td>
            <td class="name-cell">{{ holding.name }}</td>
            <td class="quantity-cell">{{ holding.quantity }}</td>
            <td class="price-cell">
              {{ formatPriceWithCurrency(holding.currentPrice, holding.currency) }}
            </td>
            <td class="value-cell">{{ formatCurrency(holding.marketValue) }}</td>
            <td class="cost-cell">
              {{ formatPriceWithCurrency(holding.averageCost, holding.currency) }}
            </td>
            <td class="cost-cell">{{ formatCurrency(holding.totalCost) }}</td>
            <td
              class="gain-loss-cell"
              [class.positive]="isPositive(holding.gainLoss)"
              [class.negative]="!isPositive(holding.gainLoss)"
            >
              {{ formatCurrency(holding.gainLoss) }}
            </td>
            <td
              class="percent-cell"
              [class.positive]="isPositive(holding.gainLossPercent)"
              [class.negative]="!isPositive(holding.gainLossPercent)"
            >
              {{ formatPercent(holding.gainLossPercent) }}
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  @if (holdings().length === 0) {
    <div class="empty-state">
      <p>No holdings in your portfolio yet.</p>
      <p>Add some stocks to get started!</p>
    </div>
  }
</div>
